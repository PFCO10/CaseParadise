<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nova Crate Lab | Simulated Case Opening</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&family=Orbitron:wght@500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js" defer></script>
    <script src="script.js" defer></script>
  </head>
  <body>
    <canvas id="particleCanvas" aria-hidden="true"></canvas>
    <div id="app" v-cloak>
      <header class="glass topbar">
        <div>
          <p class="eyebrow">SIMULATED REWARD EXPERIENCE</p>
          <h1>Nova Crate Lab</h1>
          <p class="disclaimer">
            Ethical, virtual-only case opening. No real-money wagering, no cash-outs.
          </p>
        </div>
        <div class="wallet">
          <div class="chip">
            <span>ü™ô Coins</span>
            <strong>{{ state.coins }}</strong>
          </div>
          <div class="chip">
            <span>‚≠ê Level {{ level }}</span>
            <strong>{{ state.xp }} / {{ xpForNextLevel }}</strong>
          </div>
        </div>
      </header>

      <main>
        <section class="glass reward-row">
          <button class="neon" @click="claimDaily" :disabled="!dailyAvailable">Daily reward</button>
          <button class="neon" @click="completeChallenge">Challenge +120</button>
          <button class="neon" @click="claimAchievement" :disabled="achievementClaimed">Achievement</button>
          <p>
            Login streak: <strong>{{ state.streak }} day{{ state.streak === 1 ? '' : 's' }}</strong>
          </p>
        </section>

        <section>
          <div class="section-head">
            <h2>Cases</h2>
            <p class="muted">Hover cards for previews. Unlock higher tiers with level progression.</p>
          </div>
          <div class="case-grid">
            <article
              v-for="c in cases"
              :key="c.id"
              class="glass case-card"
              :class="[c.theme, { locked: level < c.unlockLevel }]"
              @mouseenter="setPreview(c)"
            >
              <div class="light"></div>
              <h3>{{ c.name }}</h3>
              <p>{{ c.description }}</p>
              <p>Cost: <strong>{{ c.cost }}</strong> coins</p>
              <p>Unlock: Level {{ c.unlockLevel }}</p>
              <div class="drop-preview" aria-live="polite">Preview: {{ previews[c.id] }}</div>
              <button
                class="open-btn"
                @click="openCase(c)"
                :disabled="rolling || level < c.unlockLevel"
              >
                {{ level < c.unlockLevel ? 'Locked' : 'Open Case' }}
              </button>
            </article>
          </div>
        </section>

        <section class="glass reel-panel">
          <div class="section-head">
            <h2>Opening Reel</h2>
            <p class="muted">Transparent probabilities below each case.</p>
          </div>
          <div class="reel-window" :style="reelGlowStyle">
            <div class="reel-track" :style="reelTrackStyle">
              <div v-for="(entry, idx) in reelItems" :key="idx" class="reel-item" :class="entry.rarity">
                {{ entry.name }}
              </div>
            </div>
            <div class="reel-pointer" aria-hidden="true"></div>
          </div>
          <p class="result" :class="lastDrop?.rarity">
            {{ rolling ? 'Rolling...' : lastDrop ? `Drop: ${lastDrop.name} (${lastDrop.rarity})` : 'Open a case to roll.' }}
          </p>
          <div class="rate-grid" v-if="selectedCase">
            <div v-for="rate in selectedCase.rates" :key="rate.rarity" class="rate-cell" :class="rate.rarity">
              <span>{{ rate.rarity }}</span><strong>{{ rate.chance }}%</strong>
            </div>
          </div>
        </section>

        <section class="panel-grid">
          <article class="glass">
            <div class="section-head">
              <h2>Inventory</h2>
              <select v-model="filterRarity" aria-label="Filter inventory by rarity">
                <option value="All">All rarities</option>
                <option v-for="r in rarities" :key="r" :value="r">{{ r }}</option>
              </select>
            </div>
            <div class="inventory-grid">
              <div class="inventory-item" v-for="(item, idx) in filteredInventory" :key="item.name + idx" :class="item.rarity">
                <h4>{{ item.name }}</h4>
                <small>{{ item.rarity }} ¬∑ {{ item.value }} value</small>
              </div>
            </div>
          </article>

          <article class="glass">
            <h2>Profile & Progression</h2>
            <label>
              Alias
              <input v-model="state.profile.alias" maxlength="18" />
            </label>
            <label>
              Neon accent
              <input type="color" v-model="state.profile.accent" />
            </label>
            <div class="xp-wrap">
              <div class="xp-bar" :style="{ width: xpPercent + '%' }"></div>
            </div>
            <p>Total inventory value: {{ totalValue }}</p>
          </article>

          <article class="glass">
            <h2>Leaderboard</h2>
            <ol class="leaderboard">
              <li v-for="player in leaderboard" :key="player.name">
                <span>{{ player.name }}</span>
                <strong>{{ player.value }}</strong>
              </li>
            </ol>
          </article>
        </section>
      </main>
    </div>
  </body>
</html>
